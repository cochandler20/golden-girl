# ============================================================
# .htaccess — Apache Security Configuration for Golden Girl
# This file controls server-level access rules and HTTP security
# headers. Requires mod_rewrite and mod_headers to be enabled
# in XAMPP's httpd.conf (they usually are by default).
# ============================================================

# ── Disable directory browsing and CGI ───────────────────────
Options -Indexes          # Prevent directory browsing (never show file listings)
Options -ExecCGI          # Disable CGI execution in this directory

# ── Block direct access to sensitive files ────────────────────
# Deny direct browser requests to config files
<FilesMatch "^(database|auth)\.php$">
    Require all denied
</FilesMatch>

# ── Rewrite Engine ────────────────────────────────────────────
<IfModule mod_rewrite.c>
    RewriteEngine On

    # ── Block direct web access to sensitive folders ──────────
    # Users can never directly browse /config/ or /includes/
    RewriteRule ^config/   - [F,L]
    RewriteRule ^includes/ - [F,L]

    # ── Clean URLs (remove .php extension) ───────────────────
    # How it works:
    #   1. If the request already maps to a real file (CSS, JS,
    #      an image), serve it directly — no rewriting needed.
    #   2. If the request maps to a real directory, serve it directly.
    #   3. Otherwise, append .php and serve that file.
    #
    # Result: visiting /login serves login.php transparently.
    #         visiting /blog-post?slug=foo serves blog-post.php?slug=foo.
    #
    # The NC flag = case-insensitive match.
    # The L  flag = stop processing rules after this one matches.

    # Skip rewriting if the request is a real file (e.g. /css/style.css)
    RewriteCond %{REQUEST_FILENAME} !-f
    # Skip rewriting if the request is a real directory
    RewriteCond %{REQUEST_FILENAME} !-d
    # Match any path that doesn't already contain a dot (no extension)
    # and rewrite it to the same path with .php appended
    RewriteRule ^([^.]+)$ $1.php [NC,L]

</IfModule>

# ── Security Headers ──────────────────────────────────────────
<IfModule mod_headers.c>
    # Prevent browsers from MIME-sniffing the content type
    Header set X-Content-Type-Options "nosniff"

    # Prevent the site from being embedded in iframes (clickjacking defense)
    Header set X-Frame-Options "SAMEORIGIN"

    # Enable browser's built-in XSS filter (older browsers)
    Header set X-XSS-Protection "1; mode=block"

    # Control what information is sent in the Referrer header
    Header set Referrer-Policy "strict-origin-when-cross-origin"

    # Permissions Policy: disable features we don't use
    Header set Permissions-Policy "geolocation=(), microphone=(), camera=()"
</IfModule>

# ── Hide PHP version from HTTP headers ───────────────────────
<IfModule mod_headers.c>
    Header unset X-Powered-By
</IfModule>

# ── Custom error pages (optional — create these files later) ──
# ErrorDocument 403 /golden-girl/errors/403.php
# ErrorDocument 404 /golden-girl/errors/404.php
# ErrorDocument 500 /golden-girl/errors/500.php

# ── Protect the .htaccess file itself ─────────────────────────
<Files ".htaccess">
    Require all denied
</Files>
